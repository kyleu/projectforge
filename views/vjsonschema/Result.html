{% import (
  "fmt"

  "projectforge.dev/projectforge/app/controller/cutil"
  "projectforge.dev/projectforge/app/lib/jsonschema"
  "projectforge.dev/projectforge/app/util"
  "projectforge.dev/projectforge/views/components"
  "projectforge.dev/projectforge/views/components/view"
) %}

{% func RenderResult(
  baseURL string, x any, sch *jsonschema.Schema, oldResult any, oldDiffs util.Diffs, newResult any, newDiffs util.Diffs, ps *cutil.PageState,
) %}
  {%- code id := util.RandomID() -%}
  <ul class="accordion">
    <li>
      <input id="accordion-{%s id %}-item" type="checkbox" hidden />
      <label for="accordion-{%s id %}-item">{%= components.ExpandCollapse(3, ps) %} Item [{%s fmt.Sprintf("%T", x) %}]</label>
      <div class="bd"><div><div>
        <div class="mt">{%= components.JSON(x) %}</div>
      </div></div></div>
    </li>
    <li>
      <input id="accordion-{%s id %}-schema" type="checkbox" hidden />
      <label for="accordion-{%s id %}-schema">{%= components.ExpandCollapse(3, ps) %} Schema</label>
      <div class="bd"><div><div>
        <div class="flex">
          <div class="flex-item">
            <strong>Content</strong>
            <div class="mt">{%= components.JSON(sch) %}</div>
          </div>
          <div class="flex-item">
            <strong>Rendered</strong>
            <div class="mt">{%= view.JSONSchema(sch, ps) %}</div>
          </div>
        </div>
      </div></div></div>
    </li>
    <li>
      <input id="accordion-{%s id %}-results" type="checkbox" hidden />
      <label for="accordion-{%s id %}-results">{%= components.ExpandCollapse(3, ps) %} Results</label>
      <div class="bd"><div><div>
        <div class="flex">
          <div class="flex-item">
            <strong>Old</strong>
            <div class="mt">{%= components.JSON(oldResult) %}</div>
          </div>
          <div class="flex-item">
            <strong>New</strong>
            <div class="mt">{%= components.JSON(newResult) %}</div>
          </div>
        </div>
      </div></div></div>
    </li>
    <li>
      <input id="accordion-{%s id %}-diffs" type="checkbox" hidden />
      <label for="accordion-{%s id %}-diffs">{%= components.ExpandCollapse(3, ps) %} Diffs</label>
      <div class="bd"><div><div>
        <div class="flex">
          <div class="flex-item">
            <strong>Old</strong>
            <div class="mt">{%= view.Diffs(oldDiffs.Sorted()) %}</div>
          </div>
          <div class="flex-item">
            <strong>New</strong>
            <div class="mt">{%= view.Diffs(newDiffs.Sorted()) %}</div>
          </div>
        </div>
      </div></div></div>
    </li>
  </ul>
{% endfunc %}
