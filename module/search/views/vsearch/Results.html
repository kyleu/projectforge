{% import (
  "{{{ .Package }}}/app"
  "{{{ .Package }}}/app/search"
  "{{{ .Package }}}/app/util"
  "{{{ .Package }}}/app/controller/cutil"
  "{{{ .Package }}}/views/layout"
) %}

{% code type Results struct {
  layout.Basic
  Params *search.Params
  Results search.Results
  Errors []error
} %}

{% func (p *Results) Body(as *app.State, ps *cutil.PageState) %}
  <div class="card">
    <h3>{% if p.Params.Q == "" %}Search{% else %}[{%s p.Params.Q %}] search results{% endif %}</h3>
    <form class="mt" action="{%s ps.SearchPath %}">
      <input name="q" value="{%s p.Params.Q %}" />
      <div class="mt"><button type="submit">Search Again</button></div>
    </form>
  </div>
  {% if p.Params.Q != "" %}
  <div class="card">
    <h3>{%s util.PluralMaybe("Result", len(p.Results)) %}</h3>
    {% if len(p.Results) == 0 %}
    <div class="mt"><em>no results</em></div>
    {% else %}
    <table class="mt">
      <tbody>
        {% for _, res := range p.Results %}
        <tr>
          <td class="shrink"><a href="{%s res.URL %}">{% if res.Title == "" %}{%s res.URL %}{% else %}{%s res.Title %}{% endif %}</a></td>
          <td>{%= Match(p.Params) %}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}
  </div>
  {% endif %}
  {% if len(p.Errors) > 0 %}
  <div class="card">
    <h3>{%s util.PluralMaybe("Error", len(p.Errors)) %}</h3>
    <ul>
      {% for _, e := range p.Errors %}
      <li>{%s e.Error() %}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}
{% endfunc %}

{% func Match(params *search.Params) %}
  {%s params.Q %}!!!
{% endfunc %}
